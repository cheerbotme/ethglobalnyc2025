
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="monetization" content="YOUR_PAYMENT_POINTER">
    <title>Cheerbot Remote Control</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
      .blockchain-card {
        transition: all 0.3s ease;
      }
      .blockchain-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .last-updated {
        font-size: 0.75rem;
        color: #6b7280;
      }
	</style>
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
      <header class="text-center mb-12">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Cheerbot Remote Control</h1>
        <p class="text-gray-600">Monitoring ERC7827 Contracts on Flow and Katana</p>
      </header>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Flow Blockchain Card -->
        <div class="blockchain-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-blue-600">Flow Mainnet</h2>
            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
              Connected
            </span>
          </div>
          <div class="space-y-4">
            <div>
              <p class="text-sm text-gray-500">Contract Address</p>
              <p class="font-mono text-sm break-all">0x04B386e36F89E5bB568295779089E91ded070057</p>
            </div>
            <div class="grid grid-cols-1 gap-2">
              <div>
                <p class="text-sm text-gray-500">Network</p>
                <p id="flow-network" class="font-medium">-</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Chain ID</p>
                <p id="flow-chain-id" class="font-medium">-</p>
              </div>
            </div>
            <div class="pt-4 border-t border-gray-100">
              <p class="text-sm text-gray-500">Last Updated</p>
              <p id="flow-updated" class="text-sm">-</p>
            </div>
            <div class="pt-4 border-t border-gray-100">
              <p class="text-sm text-gray-500 font-medium mb-1">JSON Data</p>
              <pre id="flow-json" class="text-xs bg-gray-50 p-2 rounded overflow-auto max-h-40">Loading...</pre>
            </div>
          </div>
        </div>

        <!-- Katana Blockchain Card -->
        <div class="blockchain-card bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-purple-600">Katana Tatara</h2>
            <span class="px-3 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded-full">
              Connected
            </span>
          </div>
          <div class="space-y-4">
            <div>
              <p class="text-sm text-gray-500">Contract Address</p>
              <p class="font-mono text-sm break-all">0x77331C208e7a6d4C05b0A0f87dB2Df9f154321a8</p>
            </div>
            <div class="grid grid-cols-1 gap-2">
              <div>
                <p class="text-sm text-gray-500">Network</p>
                <p id="katana-network" class="font-medium">-</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Chain ID</p>
                <p id="katana-chain-id" class="font-medium">-</p>
              </div>
            </div>
            <div class="pt-4 border-t border-gray-100">
              <p class="text-sm text-gray-500">Last Updated</p>
              <p id="katana-updated" class="text-sm">-</p>
            </div>
            <div class="pt-4 border-t border-gray-100">
              <p class="text-sm text-gray-500 font-medium mb-1">JSON Data</p>
              <pre id="katana-json" class="text-xs bg-gray-50 p-2 rounded overflow-auto max-h-40">Loading...</pre>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Section -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4">Chat</h2>
        <div class="space-y-4">
          <div id="chat-messages" class="h-64 overflow-y-auto border rounded p-4 mb-4">
            <!-- Messages will appear here -->
          </div>
          <form id="chat-form" class="flex space-x-2">
            <input 
              id="message-input" 
              type="text" 
              placeholder="Type your message..." 
              class="flex-1 border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
              autocomplete="off"
            >
            <button 
              type="submit" 
              class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors"
            >
              Send
            </button>
          </form>
        </div>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      // Initialize Socket.IO
      const socket = io();
      
      // DOM Elements
      const chatForm = document.getElementById('chat-form');
      const messageInput = document.getElementById('message-input');
      const chatMessages = document.getElementById('chat-messages');

      // Blockchain configuration
      const BLOCKCHAINS = {
        flow: {
          id: 'flow',
          name: 'Flow Mainnet',
          color: 'blue',
          contractAddress: '0x04B386e36F89E5bB568295779089E91ded070057',
          chainId: 747,
          network: 'flow-mainnet-evm'
        },
        katana: {
          id: 'katana',
          name: 'Katana Tatara',
          color: 'purple',
          contractAddress: '0x77331C208e7a6d4C05b0A0f87dB2Df9f154321a8',
          chainId: 129399,
          network: 'katana-tatara-testnet'
        }
      };

      // Function to add a message to the chat UI
      function addMessageToChat(data) {
        if (!chatMessages) return;
        const messageElement = document.createElement('div');
        messageElement.className = 'mb-2 p-2 bg-gray-50 rounded';
        
        // Format timestamp if available
        const timestamp = data.timestamp ? new Date(data.timestamp).toLocaleTimeString() : '';
        messageElement.innerHTML = `
          <div class="flex justify-between text-xs text-gray-500 mb-1">
            <span class="font-medium">${data.sender || 'User'}</span>
            <span>${timestamp}</span>
          </div>
          <div class="text-gray-800">${data.message}</div>
        `;
        
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      // Handle incoming chat messages
      socket.on('chat-message', (data) => {
        addMessageToChat(data);
      });
      
      // Handle chat history when first connecting
      socket.on('chat-history', (messages) => {
        if (!messages || !messages.length) return;
        messages.forEach(msg => addMessageToChat(msg));
      });

      // Handle chat form submission
      if (chatForm) {
        chatForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const message = messageInput?.value?.trim();
          if (message) {
            try {
              // Send message using legacy endpoint
              await fetch('/ETHGlobal', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  message: message,
                  messenger: 'You'
                })
              });
              
              // Clear the input
              messageInput.value = '';
            } catch (error) {
              console.error('Error sending message:', error);
            }
          }
        });
      }

      // Format JSON for display
      const formatJsonForDisplay = (json) => {
        if (!json) return 'No data available';
        try {
          const data = typeof json === 'string' ? JSON.parse(json) : json;
          if (Object.keys(data).length === 0) return '{}';
          return JSON.stringify(data, null, 2);
        } catch (e) {
          return String(json);
        }
      };

      // Format timestamp
      const formatTimestamp = (timestamp) => {
        if (!timestamp) return '-';
        const date = new Date(timestamp);
        return date.toLocaleTimeString();
      };

      // Update blockchain card UI
      const updateBlockchainCard = (chainId, data) => {
        const chain = BLOCKCHAINS[chainId];
        if (!chain) return;

        // Update last updated time
        const updatedElement = document.getElementById(`${chainId}-updated`);
        if (updatedElement) {
          updatedElement.textContent = formatTimestamp(data.timestamp);
        }

        // Update network info
        const networkElement = document.getElementById(`${chainId}-network`);
        const chainIdElement = document.getElementById(`${chainId}-chain-id`);
        
        if (networkElement) networkElement.textContent = chain.network;
        if (chainIdElement) chainIdElement.textContent = chain.chainId;

        // Update JSON data
        const jsonElement = document.getElementById(`${chainId}-json`);
        if (jsonElement) {
          if (data.error) {
            jsonElement.textContent = `Error: ${data.error}`;
            jsonElement.classList.add('text-red-500');
          } else {
            jsonElement.textContent = formatJsonForDisplay(data.data || data);
            jsonElement.classList.remove('text-red-500');
          }
        }
      };

      // Handle blockchain data updates
      socket.on('blockchain-update', (data) => {
        Object.keys(BLOCKCHAINS).forEach(chainId => {
          if (data[chainId]) {
            updateBlockchainCard(chainId, data[chainId]);
          }
        });
      });

      // Initial data load
      fetch('/api/blockchain-data')
        .then(response => response.json())
        .then(data => {
          socket.emit('blockchain-update', data);
        })
        .catch(error => {
          console.error('Error loading initial data:', error);
        });
    </script>
  </body>
</html>
